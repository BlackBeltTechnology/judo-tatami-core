//////////////////////////////////////////////////////////////////////////////
// G E N E R A T E D    C L A S S
// ------------------------------
// Factory expression: {{{ cleanup template.factoryExpression }}}
// Path expression: {{{ cleanup template.pathExpression }}}
// Overwrite: {{{ cleanup template.overwriteExpression }}}
// Template name: {{ template.templateName }}
// Application: {{ application.name }}

import 'package:flutter/material.dart';
import 'package:flutter_mobx/flutter_mobx.dart';
import 'package:judo_flutter_components/judo_flutter_components.dart';
import 'package:{{ modelPackage application.name }}/{{ path application.name }}/ui/pages/dialogs/helper_stores/package.dart';

Future<FilterStore> judoShowMenu({@required BuildContext context, @required List<PopupMenuEntry<FilterStore>> items, @required GlobalKey buttonKey}) async {
  final RenderBox button = buttonKey.currentContext.findRenderObject() as RenderBox;
  final RenderBox overlay = Navigator.of(context).overlay.context.findRenderObject() as RenderBox;
  final RelativeRect position = RelativeRect.fromLTRB(
    button.localToGlobal(button.size.topCenter(Offset.zero), ancestor: overlay).dx,
    button.localToGlobal(button.size.topCenter(Offset.zero), ancestor: overlay).dy,
    button.localToGlobal(button.size.bottomRight(Offset.zero) + Offset.zero, ancestor: overlay).dx,
    button.localToGlobal(button.size.bottomRight(Offset.zero) + Offset.zero, ancestor: overlay).dy,
  );

  return await showMenu<FilterStore>(
    context: context,
    position: position,
    items: items,
  );
}

List<PopupMenuEntry<FilterStore>> getPopupMenuAttributeItems(List<FilterStore> filterStoreList){
  var copiedList = List.from(filterStoreList);
  var attributeList = copiedList.map((e) => e.attributeName).toSet();
  copiedList.retainWhere((e) => attributeList.remove(e.attributeName));
  return copiedList.map<PopupMenuEntry<FilterStore>>( (filterStore) {
    return PopupMenuItem<FilterStore>(
      value: filterStore,
      child: Text(filterStore.attributeLabel),
    );
  }).toList();
}

List<PopupMenuEntry<FilterStore>> getPopupMenuOperationItemsByAttribute(List<FilterStore> filterStoreList, FilterStore selectedAttribute){
  var operationListByAttribute = filterStoreList.where((element) => element.attributeName == selectedAttribute.attributeName);
  return operationListByAttribute.map<PopupMenuEntry<FilterStore>>( (filterStore) {
    return PopupMenuItem<FilterStore>(
      value: filterStore,
      enabled: !filterStore.filterEnabled,
      child: Text(filterStore.filterOperationLabel),
    );
  }).toList();
}

List<Widget> getInputFilterWidgets(Map<FilterStore, Widget> filterStoreWidgetMap){
  return filterStoreWidgetMap.keys.map<Widget>( (filterStore) {
    return Observer(
      builder: (_) => filterStore.filterEnabled ?  Row(
        children: [
          filterStoreWidgetMap[filterStore],
          IconButton(
            icon: Icon(Icons.close),
            tooltip: 'Remove filter field',
            onPressed: () {
              filterStore.changeFilterEnabled();
            },
          )
        ],
      ) : Container(),
    );
  }).toList();
}

List<Widget> getInputFilterWidgetsForTablePage(Map<FilterStore, Widget> filterStoreWidgetMap, double layoutMaxCols){
    int colSize;
    if(layoutMaxCols >= 12) {
        colSize = 2;
    } else if(layoutMaxCols >= 8) {
        colSize = 1;
    } else if(layoutMaxCols >= 4) {
        colSize = 0;
    } else {
        colSize = 0;
    }
    return filterStoreWidgetMap.keys.map<Widget>( (filterStore) {
        return Observer(
            builder: (_) => filterStore.filterEnabled ?  JudoRow(
                crossAxisAlignment: CrossAxisAlignment.center,
                col: 1,
                row: 1,
                children: [
                    filterStoreWidgetMap[filterStore],
                    IconButton(
                        icon: Icon(Icons.close),
                        tooltip: 'Remove filter field',
                        onPressed: () {
                            filterStore.changeFilterEnabled();
                        },
                    ),
                    JudoSpacer(col: colSize, row: 1),
                ],
            ) : Container(),
        );
    }).toList();
}

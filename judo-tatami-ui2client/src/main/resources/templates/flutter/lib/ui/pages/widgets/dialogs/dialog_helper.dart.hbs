//////////////////////////////////////////////////////////////////////////////
// G E N E R A T E D    C L A S S
// ------------------------------
// Factory expression: {{{ cleanup template.factoryExpression }}}
// Path expression: {{{ cleanup template.pathExpression }}}
// Overwrite: {{{ cleanup template.overwriteExpression }}}
// Template name: {{ template.templateName }}
// Application: {{ application.name }}

part of {{ variable application.name }}.ui.pages.dialogs;

Future<FilterStore> _judoShowMenu({@required BuildContext context, @required List<PopupMenuEntry<FilterStore>> items, @required GlobalKey buttonKey}) async {
  final RenderBox button = buttonKey.currentContext.findRenderObject() as RenderBox;
  final RenderBox overlay = Navigator.of(context).overlay.context.findRenderObject() as RenderBox;
  final RelativeRect position = RelativeRect.fromLTRB(
    button.localToGlobal(button.size.topCenter(Offset.zero), ancestor: overlay).dx,
    button.localToGlobal(button.size.topCenter(Offset.zero), ancestor: overlay).dy,
    button.localToGlobal(button.size.bottomRight(Offset.zero) + Offset.zero, ancestor: overlay).dx,
    button.localToGlobal(button.size.bottomRight(Offset.zero) + Offset.zero, ancestor: overlay).dy,
  );

  return await showMenu<FilterStore>(
    context: context,
    position: position,
    items: items,
  );
}

List<PopupMenuEntry<FilterStore>> _getPopupMenuAttributeItems(List<FilterStore> filterStoreList){
  var copiedList = List.from(filterStoreList);
  var attributeList = copiedList.map((e) => e.attributeName).toSet();
  copiedList.retainWhere((e) => attributeList.remove(e.attributeName));
  return copiedList.map<PopupMenuEntry<FilterStore>>( (filterStore) {
    return PopupMenuItem<FilterStore>(
      value: filterStore,
      child: Text(filterStore.attributeName),
    );
  }).toList();
}

List<PopupMenuEntry<FilterStore>> _getPopupMenuOperationItemsByAttribute(List<FilterStore> filterStoreList, FilterStore selectedAttribute){
  var operationListByAttribute = filterStoreList.where((element) => element.attributeName == selectedAttribute.attributeName);
  return operationListByAttribute.map<PopupMenuEntry<FilterStore>>( (filterStore) {
    return PopupMenuItem<FilterStore>(
      value: filterStore,
      enabled: !filterStore.filterEnabled,
      child: Text(filterStore.filterOperation),
    );
  }).toList();
}

List<Widget> _getInputFilterWidgets(Map<FilterStore, Widget> filterStoreWidgetMap){
  return filterStoreWidgetMap.keys.map<Widget>( (filterStore) {
    return Observer(
      builder: (_) => filterStore.filterEnabled ?  Row(
        children: [
          filterStoreWidgetMap[filterStore],
          IconButton(
            icon: Icon(Icons.close),
            tooltip: 'Remove filter field',
            onPressed: () {
              filterStore.changeFilterEnabled();
            },
          )
        ],
      ) : Container(),
    );
  }).toList();
}

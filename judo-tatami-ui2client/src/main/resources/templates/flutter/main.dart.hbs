{{log 'Main launcher generation for' (variable application.name) level='info'}}
//////////////////////////////////////////////////////////////////////////////
// G E N E R A T E D    C L A S S
// ------------------------------
// Factory expression: {{{ cleanup template.factoryExpression }}}
// Path expression: {{{ cleanup template.pathExpression }}}
// Overwrite: {{{ cleanup template.overwriteExpression }}}
// Template name: {{ template.templateName }}
// Application: {{ application.name }}

import 'package:flutter/material.dart';
import 'package:openapi_dart_common/openapi.dart';
import 'package:judo_flutter_components/judo_flutter_components.dart';

import '{{ path application.name }}/app_theme.dart';
import '{{ path application.name }}/injector/injector.dart';
import '{{ path application.name }}/app.dart';
import '{{ path application.name }}/oauth.dart';
import '{{ path application.name }}/utilities/package.dart';

void main() async {
    JudoComponentCustomizer.set(new AppDesignCustomizer());

    configureDependencies();

    var apiUrl = await UrlUtil.getApiUrl();

    // Call the meta data with no token refresh interceptor
    ApiClient _apiClient = ApiClient(basePath: apiUrl, apiClientDelegate: DioClientDelegate());
    locator.registerSingleton<ApiClient>(_apiClient);
    try {
        await Oauth.loadClientMetaData();
        Info.serverDown = false;
    } on ApiException catch (error){
        if (error.code == 500 && error.message.contains('Connection')) {
            Info.serverDown = true;
        }
    }

    if (Oauth.isAuthenticationRequired()) {
        locator.unregister(instance: _apiClient);

        // Add the token refresh interceptor for the rest of the api calls
        _apiClient = ApiClient(basePath: apiUrl, apiClientDelegate: Oauth.getDioDelegate());
        locator.registerSingleton<ApiClient>(_apiClient);

        if (!isNavigateToSettingsPage) {
            Oauth.loginAuthorizeAndExchangeCode();
        }

        var token = await Oauth.processLogin();
        Oauth.udpateAuthInfo(token);
        await Oauth.addTokenToApiClient(token);
    }
    await Oauth.checkPrincipal();

    runApp({{ fqClass application.name }}Application());
}
